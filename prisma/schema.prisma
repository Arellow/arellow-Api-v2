// npx prisma db push

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Company {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  website     String?
  users       User[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum KycStatus {
  PENDING
  VERIFIED
  FAILED
}

enum KycDocumentType {
  NIN
  PASSPORT
  NATIONALID
}

 enum UserPhotoType {
 PROFILE
  KYC

 } 

model UserMedia {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  type      MediaType
  photoType UserPhotoType? // Optional if not PHOTO

  url      String
  publicId String
  caption  String?
  altText  String?
  order    Int?

  width    Int?
  height   Int?
  duration Float?
  sizeInKB Float?
  format   String?

  createdAt DateTime @default(now())
}

model Kyc {
  id             String          @id @default(auto()) @map("_id") @db.ObjectId
   user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId
  documentType   KycDocumentType
  documentNumber String
  documentPhoto  String
  status         KycStatus       @default(PENDING)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
   @@unique(userId)
}

model User {
  id                String             @id @default(auto()) @map("_id") @db.ObjectId
  email             String             @unique
  fullname          String
  username          String
  password          String
  phone_number      String
  role              UserRole
  avatar            String?            @default("https://img.freepik.com/premium-vector/male-face-avatar-icon-set-flat-design-social-media-profiles_1281173-3806.jpg?semt=ais_hybrid&w=740")
  is_verified       Boolean            @default(false)
  suspended         Boolean            @default(false)
  points            Int?
  last_login        DateTime?
  rewardHistory     RewardHistory[]
  rewardWithdrawals RewardWithdrawal[]
  companyId         String?            @db.ObjectId
  company           Company?           @relation(fields: [companyId], references: [id])
  likes             UserPropertyLike[]

  properties         Property[]                 @relation("UserProperties")
  approvedProperties Property[]                 @relation("ApprovedProperties")
  PropertyRequest    PropertyRequest[]
  mortgage           MortgageCalculationDraft[]
  Campaign           Campaign[]
  preQualifications  PreQualification[]
  createdAt          DateTime                   @default(now())
  updatedAt          DateTime                   @updatedAt
  Blog               Blog[]

  kyc   Kyc?   
}

enum UserRole {
  ADMIN
  SUPER_ADMIN
  REALTOR
  DEVELOPER
  BUYER
}

enum PropertyStatus {
  PENDING
  APPROVED
  REJECTED
}

model Property {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  title        String
  description  String
  category     String
  features     String[]
  amenities    Amenity[]
  country      String
  state        String
  city         String
  neighborhood String
  location     GeoPoint

  bedrooms     Int
  bathrooms    Int
  floors       Int
  squareMeters Int
  price        Float

  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id], name: "UserProperties")

  status          PropertyStatus @default(PENDING)
  rejectionReason String?
  approvedById    String?        @db.ObjectId
  approvedBy      User?          @relation("ApprovedProperties", fields: [approvedById], references: [id])

  likedBy    UserPropertyLike[]
  likesCount Int                @default(0)

  rewardHistories RewardHistory[]

  media       Media[]
  salesStatus SalesStatus @default(SELLING)

  archived          Boolean @default(false)
  isFeatureProperty Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum SalesStatus {
  SELLING
  SOLD
}

model Amenity {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  photoUrl   String
  propertyId String   @db.ObjectId
  property   Property @relation(fields: [propertyId], references: [id])
}

model UserPropertyLike {
  id         String @id @default(auto()) @map("_id") @db.ObjectId
  userId     String @db.ObjectId
  propertyId String @db.ObjectId

  user     User     @relation(fields: [userId], references: [id])
  property Property @relation(fields: [propertyId], references: [id])

  @@unique([userId, propertyId])
}

type GeoPoint {
  lat Float
  lng Float
}

enum MediaType {
  PHOTO
  VIDEO
  TOUR_3D
}

enum PhotoType {
  FRONT_VIEW
  LIVING_ROOM
  KITCHEN
  FLOOR_PLAN
  PRIMARY_ROOM
  OTHER
}

model Media {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  property   Property @relation(fields: [propertyId], references: [id])
  propertyId String   @db.ObjectId

  type      MediaType
  photoType PhotoType? // Optional if not PHOTO

  url      String
  publicId String
  caption  String?
  altText  String?
  order    Int?

  width    Int?
  height   Int?
  duration Float?
  sizeInKB Float?
  format   String?

  createdAt DateTime @default(now())
}

model RewardHistory {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  points      Int      @default(0)
  reason      String
  description String?
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id])
  propertyId  String   @db.ObjectId // This is a foreign key
  property    Property @relation(fields: [propertyId], references: [id])
}

model RewardWithdrawal {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  user              User     @relation(fields: [userId], references: [id])
  userId            String   @db.ObjectId
  points            Int // amount the user requested to withdraw
  bankAccountName   String
  bankAccountNumber String
  bankName          String
  status            String   @default("pending")
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([userId])
}

model ResetPassword {
  id          String @id @default(auto()) @map("_id") @db.ObjectId
  userId      String
  resetString String
  createdAt   Int
  expiresAt   Int
}

model Subscribe {
  id    String  @id @default(auto()) @map("_id") @db.ObjectId
  email String?
  phone String?
}

model PropertyRequest {
  id                   String  @id @default(auto()) @map("_id") @db.ObjectId
  name                 String
  agent_category       String?
  email                String
  phone_number         String
  country              String  @default("Nigeria")
  state                String
  property_location    String
  neighborhood         String
  property_category    String
  property_type        String
  furnishing_status    String?
  number_of_bedrooms   Int?
  number_of_bathrooms  Int?
  budget               Float?
  property_description String?

  status    String   @default("pending") // pending, approved, rejected
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String?  @db.ObjectId
  user      User?    @relation(fields: [userId], references: [id])
}

model PreQualification {
  id                  String   @id @default(auto()) @map("_id") @db.ObjectId
  name                String
  role                String?
  email               String
  phone               String
  home_address        String?
  state               String
  city                String
  property_category   String
  neighbourhood       String?
  monthly_budget      Float
  down_payment_goal   Float
  business_or_civil   String?
  employer_name       String?
  level_of_employment String?
  bank_name           String?
  userId              String   @db.ObjectId // Required for linking to User
  user                User     @relation(fields: [userId], references: [id])
  createdAt           DateTime @default(now())
}

model MortgageCalculationDraft {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  home_location String
  home_price    Float
  down_payment  Float
  userId        String?  @db.ObjectId
  user          User?    @relation(fields: [userId], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Campaign {
  id                  String   @id @default(auto()) @map("_id") @db.ObjectId
  campaignType        String
  localMediaName      String
  promotionAd         String
  targetAudience      String
  features            String
  campaignDescription String
  imageUrl            String?
  mediaPlatforms      String[]
  impressions         Int      @default(0)
  clicks              Int      @default(0)
  conversions         Int      @default(0)
  cpc                 Float    @default(0)
  spend               Float    @default(0)
  startDate           DateTime
  endDate             DateTime
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  userId              String   @db.ObjectId
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model State {
  id    String @id @default(auto()) @map("_id") @db.ObjectId
  name  String @unique
  image String
}

model Blog {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id])
  title     String
  content   String
  category  String   @default("Internal Blog")
  imageUrl  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}
